name: TrainDetail For PathFinder Runner With QueryCC

on:
  # æ­¤ä»»åŠ¡ä¸ºæ‰‹åŠ¨è§¦å‘ï¼Œå› ä¸ºè¦è·å–å¤§é‡è·¯ç½‘çš„è½¦æ¬¡
  #  schedule:
  #    # æ¯å¤©16ç‚¹15åˆ†UTCè¿è¡Œï¼ˆåŒ—äº¬æ—¶é—´0ç‚¹15åˆ†ï¼‰
  #    - cron: '15 16 * * *'
  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

jobs:
  run-logic:
    runs-on: ubuntu-latest
    
    # æ·»åŠ æƒé™è®¾ç½®
    permissions:
      contents: write
    
    steps:
      # æ­¥éª¤ 1: å…‹éš†é€»è¾‘ä»“åº“åˆ°å½“å‰å·¥ä½œç›®å½•
      - name: Clone Private Logic Repository
        env:
          MY_GITHUB_MINI_ACTION_LOGIC_URL: ${{ secrets.MY_GITHUB_MINI_ACTION_LOGIC_URL }}
        run: |
          echo "ğŸ”‘ Cloning private logic repository: ${REPO_OWNER}/${REPO_NAME}"
          # ç›´æ¥å…‹éš†åˆ°å½“å‰ç›®å½• (.)
          git clone ${MY_GITHUB_MINI_ACTION_LOGIC_URL} .
          echo "âœ… Private logic cloned to current directory."

      # æ­¥éª¤ 2: è®¾ç½® Node.js ç¯å¢ƒ
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      # æ­¥éª¤ 3: å®‰è£…é€»è¾‘ä»“åº“çš„ä¾èµ–
      - name: Install Dependencies
        run: npm ci

      # æ­¥éª¤ 4: è¿è¡Œ TypeScript è„šæœ¬
      - name: Run Core Logic Script
        env:
          # --- åœ¨è¿™é‡Œä¼ é€’æ‰€æœ‰å¿…è¦çš„ Secrets ---
          MY_GITHUB_MINI_DATA_UPLOADER_URL: ${{ secrets.MY_GITHUB_MINI_DATA_UPLOADER_URL }}
          MY_GITHUB_MINI_DATA_DOWNLOADER_URL: ${{ secrets.MY_GITHUB_MINI_DATA_DOWNLOADER_URL }}
          MY_GITHUB_MINI_DATABASE_URL: ${{ secrets.MY_GITHUB_MINI_DATABASE_URL }}
          MY_GITHUB_MINI_ACTION_LOGIC_URL: ${{ secrets.MY_GITHUB_MINI_ACTION_LOGIC_URL }}
        # ä½¿ç”¨ npx tsx ç›´æ¥è¿è¡Œç§æœ‰ä»“åº“ä¸­çš„è„šæœ¬
        # è¯·ç¡®ä¿è¿™ä¸ªè·¯å¾„å’Œæ–‡ä»¶åä¸æ‚¨ç§æœ‰ä»“åº“ä¸­çš„å…¥å£æ–‡ä»¶ä¸€è‡´
        run: npx tsx src/runner/train-detail-runner/TrainDetailForPathFinderRunnerWithQueryCC.ts
